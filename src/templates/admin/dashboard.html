{% extends 'admin/master.html' %}

{% block body %}
<div class="container-fluid" style="margin-top:10px;">
    <h3 style="margin-bottom:15px;"><b>RESUMEN:</b></h3>
    <div class="row">
        <div class="col-md-12 col-sm-12">
            <div class="panel panel-success">
                <div class="panel-heading">Ingresos Ãºltimos 30 dÃ­as</div>
                <div class="panel-body">
                    <h3 style="display:inline-block; margin:0;">
                        <b>{{ "%.2f"|format(metrics.ingresos_30d) }}â‚¬</b>
                    </h3>
                    <small style="display:inline-block; margin-left:10px;">
                        {% if metrics.variacion_es_nueva %}
                        <span style="color:green;">â–² {{ metrics.variacion_label }}</span>
                        <span class="text-muted"> (sin periodo anterior)</span>
                        {% else %}
                        {% if metrics.variacion_up %}
                        <span style="color:green;">â–² {{ metrics.variacion_label }}</span>
                        {% else %}
                        <span style="color:red;">â–¼ {{ metrics.variacion_label }}</span>
                        {% endif %}
                        respecto a los 30 dÃ­as anteriores
                        {% endif %}

                    </small>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-3">
            <div class="panel panel-primary">
                <div class="panel-heading">Productos</div>
                <div class="panel-body"><strong>{{ metrics.products_count }}</strong></div>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="panel panel-primary">
                <div class="panel-heading">Pedidos</div>
                <div class="panel-body"><strong>{{ metrics.orders_count }}</strong></div>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="panel panel-primary">
                <div class="panel-heading">Facturas</div>
                <div class="panel-body"><strong>{{ metrics.invoices_count }}</strong></div>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="panel panel-primary">
                <div class="panel-heading">Usuarios</div>
                <div class="panel-body"><strong>{{ metrics.users_count }}</strong></div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 col-sm-12">
            <div class="panel panel-primary">
                <div class="panel-heading">Ãšltimos pedidos</div>
                <div class="panel-body" style="padding:0;">
                    <div class="table-responsive"> <!-- ðŸ”¥ Scroll horizontal en mÃ³vil -->
                        <table class="table table-striped" style="margin:0;">
                            <thead>
                                <tr>
                                    <th>Cliente</th>
                                    <th>Fecha</th>
                                    <th>Estado</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for o in recent_orders %}
                                <tr>
                                    <td>{{ (o.user.email if o.user else 'â€”') }}</td>
                                    <td>{{ tz_es(o.order_date) if o.order_date else '' }}</td>
                                    <td>{{ o.order_status }}</td>
                                    <td>{{ "{:.2f}".format(o.total_amount or 0) }}â‚¬</td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="5" class="text-muted">Sin datos</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-sm-12">
            <div class="panel panel-primary">
                <div class="panel-heading">Ãšltimas facturas</div>
                <div class="panel-body" style="padding:0;">
                    <div class="table-responsive"> <!-- ðŸ”¥ Scroll horizontal en mÃ³vil -->
                        <table class="table table-striped" style="margin:0;">
                            <thead>
                                <tr>
                                    <th>Nro. Factura</th>
                                    <th>Cliente</th>
                                    <th>Importe</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for f in recent_invoices %}
                                <tr>
                                    <td>{{ f.invoice_number }}</td>
                                    <td>{{ f.client_name or 'â€”' }}</td>
                                    <td>{{ "{:.2f}".format(f.amount or 0) }}â‚¬</td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="4" class="text-muted">Sin datos</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="panel panel-primary">
                <div class="panel-heading">Ticket medio</div>
                <div class="panel-body">
                    <h3><b>{{ "%.2f"|format(metrics.avg_ticket) }}â‚¬</b></h3>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}